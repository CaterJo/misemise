{"ast":null,"code":"import _objectSpread from \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/src/component/map/Map.jsx\";\nimport React, { Component } from 'react';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { getDataAsync } from '../../store/modules';\nimport loadJs from 'load-js';\nvar styleOptions = {\n  fillOpacity: 0.6,\n  fillColor: '#ff0000',\n  strokeColor: '#ff0000',\n  strokeWeight: 2,\n  strokeOpacity: 0.5\n};\n\nvar Map =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Map, _Component);\n\n  function Map() {\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Map).call(this));\n    _this.map = React.createRef();\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"loadScriptPromise\",\n    value: function loadScriptPromise(_ncpClientId) {\n      var requestUrl = 'https://openapi.map.naver.com/openapi/v3/maps.js';\n      requestUrl += \"?ncpClientId=\".concat(_ncpClientId);\n      requestUrl += '&submodules=geocoder';\n      return loadJs(requestUrl).then(function () {\n        var navermaps = window.naver;\n        return new Promise(function (resolve) {\n          // onJSContentLoaded JS가 로드됐을 때 실행되는 이벤트 핸들러.\n          navermaps.maps.onJSContentLoaded = function () {\n            resolve(navermaps);\n          };\n        });\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          ncpClientId = _this$props.ncpClientId,\n          getDataAsync = _this$props.getDataAsync,\n          _lat = _this$props._lat,\n          _lng = _this$props._lng,\n          zoomLevel = _this$props.zoomLevel;\n      this.loadScriptPromise(ncpClientId).then(function (naver) {\n        var zoomRange = [2, 4, 6];\n        var maxZoom = zoomRange[zoomRange.length - 1];\n        var minZoom = zoomRange[0]; // 전국 : 2, 시군구 :4  읍면동 : 7\n        // naver.maps. PointBounds 경계 생성.\n        // 인터렉션 옵션.\n\n        var mapOptions = {\n          logoControl: false,\n          mapDataControl: false,\n          scaleControl: false,\n          center: new naver.maps.LatLng(_lat, _lng),\n          // 충주\n          draggable: false,\n          scrollWheel: false,\n          keyboardShortcuts: false,\n          disableDoubleTapZoom: true,\n          disableDoubleClickZoom: true,\n          disableTwoFingerTapZoom: true,\n          zoom: zoomLevel,\n          // baseTileOpacity: 0.5,\n          maxZoom: maxZoom,\n          minZoom: minZoom\n        };\n        var map = new naver.maps.Map('map', mapOptions);\n\n        _this2.setState(function (prevState) {\n          return _objectSpread({}, prevState, {\n            newMap: map,\n            parentCd: []\n          });\n        });\n\n        map.data.setStyle(function (feature) {\n          var korLv = feature.property_KOR_LV;\n\n          switch (korLv) {\n            case '좋음':\n              styleOptions.fillColor = '#117cf6';\n              break;\n\n            case '보통':\n              styleOptions.fillColor = '#50af32';\n              break;\n\n            case '나쁨':\n              styleOptions.fillColor = '#c4b341';\n              break;\n\n            case '매우나쁨':\n              styleOptions.fillColor = '#d36f36';\n              break;\n          }\n\n          return styleOptions;\n        });\n        map.data.addListener('mouseover', function (e) {\n          map.data.overrideStyle(e.feature, {\n            strokeWeight: 8\n          });\n          map.data.addListener('mouseout', function (e) {\n            map.data.revertStyle();\n          });\n        }); // zoom UP\n\n        map.data.addListener('click', function (e) {\n          var feature = e.feature;\n\n          var _e$feature$bounds$get = e.feature.bounds.getCenter(),\n              _lng = _e$feature$bounds$get.x,\n              _lat = _e$feature$bounds$get.y;\n\n          var currentZoom = map.getZoom();\n\n          if (maxZoom > currentZoom) {\n            var parentCd = feature.property_LOC_CD;\n\n            var tempArr = _this2.state.parentCd.slice();\n\n            tempArr.push(parentCd);\n\n            _this2.setState({\n              'parentCd': tempArr\n            });\n\n            var _zoomLevel = zoomRange[zoomRange.indexOf(currentZoom) + 1] || currentZoom;\n\n            map.setZoom(_zoomLevel);\n            map.setCenter(new naver.maps.LatLng(_lat, _lng));\n            getDataAsync({\n              _lat: _lat,\n              _lng: _lng,\n              zoomLevel: _zoomLevel,\n              naver: naver,\n              map: map,\n              parentCd: parentCd,\n              feature: feature\n            });\n          }\n        }); // zoom Down\n\n        map.data.addListener('rightclick', function (e) {\n          var _e$feature$bounds$get2 = e.feature.bounds.getCenter(),\n              _lng = _e$feature$bounds$get2.x,\n              _lat = _e$feature$bounds$get2.y;\n\n          var currentZoom = map.getZoom();\n\n          if (minZoom < currentZoom) {\n            var nextIdx = zoomRange.indexOf(currentZoom) - 1;\n\n            var _zoomLevel2 = zoomRange[nextIdx] || currentZoom;\n\n            map.setZoom(_zoomLevel2);\n            map.setCenter(new naver.maps.LatLng(_lat, _lng));\n\n            var parentCd = _this2.state.parentCd.shift();\n\n            getDataAsync({\n              _lat: _lat,\n              _lng: _lng,\n              zoomLevel: _zoomLevel2,\n              naver: naver,\n              map: map,\n              parentCd: parentCd\n            });\n          }\n        });\n        return getDataAsync({\n          _lat: _lat,\n          _lng: _lng,\n          zoomLevel: zoomLevel,\n          naver: naver,\n          map: map\n        });\n      }).catch(function (ex) {\n        console.error(ex);\n      }); // END _promise\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var data = this.props.data;\n\n      if (data && data.geoData) {\n        var allFeature = this.state.newMap.data.getAllFeature();\n\n        if (allFeature.length > 0) {\n          while (allFeature.length > 0) {\n            var item = allFeature[0];\n            this.state.newMap.data.removeFeature(item);\n          }\n        }\n\n        data.geoData.forEach(function (element) {\n          _this3.state.newMap.data.addGeoJson(element);\n        });\n      }\n\n      return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n        id: \"map\",\n        style: {\n          width: '100%',\n          height: 600 + 'px'\n        },\n        ref: this.map,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Map;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    mapObj: state.mapObj,\n    _lat: state.lat,\n    _lng: state.lng,\n    zoomLevel: state.zoomLevel,\n    data: state.data\n  };\n};\n\nvar maDispatchToPrope = function maDispatchToPrope(dispatch) {\n  return {\n    getDataAsync: bindActionCreators(getDataAsync, dispatch)\n  };\n};\n\nexport default connect(mapStateToProps, maDispatchToPrope)(Map);","map":{"version":3,"sources":["/Users/byeonggyu/Desktop/etc/200.dev/10.project/misemise/src/component/map/Map.jsx"],"names":["React","Component","bindActionCreators","connect","getDataAsync","loadJs","styleOptions","fillOpacity","fillColor","strokeColor","strokeWeight","strokeOpacity","Map","map","createRef","_ncpClientId","requestUrl","then","navermaps","window","naver","Promise","resolve","maps","onJSContentLoaded","props","ncpClientId","_lat","_lng","zoomLevel","loadScriptPromise","zoomRange","maxZoom","length","minZoom","mapOptions","logoControl","mapDataControl","scaleControl","center","LatLng","draggable","scrollWheel","keyboardShortcuts","disableDoubleTapZoom","disableDoubleClickZoom","disableTwoFingerTapZoom","zoom","setState","prevState","newMap","parentCd","data","setStyle","feature","korLv","property_KOR_LV","addListener","e","overrideStyle","revertStyle","bounds","getCenter","x","y","currentZoom","getZoom","property_LOC_CD","tempArr","state","slice","push","indexOf","setZoom","setCenter","nextIdx","shift","catch","ex","console","error","geoData","allFeature","getAllFeature","item","removeFeature","forEach","element","addGeoJson","width","height","mapStateToProps","mapObj","lat","lng","maDispatchToPrope","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { bindActionCreators } from 'redux'\nimport { connect } from 'react-redux'\nimport { getDataAsync } from '../../store/modules'\nimport loadJs from 'load-js'\n\nconst styleOptions = {\n  fillOpacity: 0.6,\n  fillColor: '#ff0000',\n  strokeColor: '#ff0000',\n  strokeWeight: 2,\n  strokeOpacity: 0.5\n}\n\nclass Map extends Component {\n  constructor () {\n    super()\n    this.map = React.createRef()\n  }\n\n  loadScriptPromise (_ncpClientId) {\n    let requestUrl = 'https://openapi.map.naver.com/openapi/v3/maps.js'\n    requestUrl += `?ncpClientId=${_ncpClientId}`\n    requestUrl += '&submodules=geocoder'\n    return loadJs(requestUrl).then(() => {\n      const navermaps = window.naver\n\n      return new Promise(resolve => {\n        // onJSContentLoaded JS가 로드됐을 때 실행되는 이벤트 핸들러.\n        navermaps.maps.onJSContentLoaded = () => {\n          resolve(navermaps)\n        }\n      })\n    })\n  }\n\n  componentDidMount () {\n    const { ncpClientId, getDataAsync, _lat, _lng, zoomLevel } = this.props\n\n    this.loadScriptPromise(ncpClientId).then((naver) => {\n      let zoomRange = [2, 4, 6]\n      let maxZoom = zoomRange[zoomRange.length - 1]\n      let minZoom = zoomRange[0]\n\n      // 전국 : 2, 시군구 :4  읍면동 : 7\n      // naver.maps. PointBounds 경계 생성.\n      // 인터렉션 옵션.\n      const mapOptions = {\n        logoControl: false,\n        mapDataControl: false,\n        scaleControl: false,\n        center: new naver.maps.LatLng(_lat, _lng), // 충주\n        draggable: false,\n        scrollWheel: false,\n        keyboardShortcuts: false,\n        disableDoubleTapZoom: true,\n        disableDoubleClickZoom: true,\n        disableTwoFingerTapZoom: true,\n        zoom: zoomLevel,\n        // baseTileOpacity: 0.5,\n        maxZoom: maxZoom,\n        minZoom: minZoom\n      }\n      let map = new naver.maps.Map('map', mapOptions)\n\n      this.setState((prevState) => {\n        return ({\n          ...prevState,\n          newMap: map,\n          parentCd: []\n        })\n      })\n\n      map.data.setStyle(function (feature) {\n        const korLv = feature.property_KOR_LV\n\n        switch (korLv) {\n          case '좋음':\n            styleOptions.fillColor = '#117cf6'\n            break\n          case '보통':\n            styleOptions.fillColor = '#50af32'\n            break\n          case '나쁨':\n            styleOptions.fillColor = '#c4b341'\n            break\n          case '매우나쁨':\n            styleOptions.fillColor = '#d36f36'\n            break\n        }\n\n        return styleOptions\n      })\n\n      map.data.addListener('mouseover', function (e) {\n        map.data.overrideStyle(e.feature, {\n          strokeWeight: 8\n        })\n\n        map.data.addListener('mouseout', function (e) {\n          map.data.revertStyle()\n        })\n      })\n\n      // zoom UP\n      map.data.addListener('click', (e) => {\n        const feature = e.feature\n        const { x: _lng, y: _lat } = e.feature.bounds.getCenter()\n        const currentZoom = map.getZoom()\n\n        if (maxZoom > currentZoom) {\n          const parentCd = feature.property_LOC_CD\n\n          const tempArr = this.state.parentCd.slice()\n          tempArr.push(parentCd)\n          this.setState({ 'parentCd': tempArr })\n          const zoomLevel = zoomRange[zoomRange.indexOf(currentZoom) + 1] || currentZoom\n          map.setZoom(zoomLevel)\n          map.setCenter(new naver.maps.LatLng(_lat, _lng))\n          getDataAsync({ _lat, _lng, zoomLevel, naver, map, parentCd, feature })\n        }\n      })\n\n      // zoom Down\n      map.data.addListener('rightclick', (e) => {\n        const { x: _lng, y: _lat } = e.feature.bounds.getCenter()\n        const currentZoom = map.getZoom()\n\n        if (minZoom < currentZoom) {\n          const nextIdx = zoomRange.indexOf(currentZoom) - 1\n          const zoomLevel = zoomRange[nextIdx] || currentZoom\n          map.setZoom(zoomLevel)\n          map.setCenter(new naver.maps.LatLng(_lat, _lng))\n\n          const parentCd = this.state.parentCd.shift()\n          getDataAsync({ _lat, _lng, zoomLevel, naver, map, parentCd })\n        }\n      })\n\n      return getDataAsync({ _lat, _lng, zoomLevel, naver, map })\n    }).catch((ex) => {\n      console.error(ex)\n    })// END _promise\n  }\n\n  render () {\n    const { data } = this.props\n    if (data && data.geoData) {\n      let allFeature = this.state.newMap.data.getAllFeature()\n\n      if (allFeature.length > 0) {\n        while (allFeature.length > 0) {\n          let item = allFeature[0]\n          this.state.newMap.data.removeFeature(item)\n        }\n      }\n\n      data.geoData.forEach(element => {\n        this.state.newMap.data.addGeoJson(element)\n      })\n    }\n\n    return (\n      <>\n        <div id=\"map\" style={{ width: '100%', height: 600 + 'px' }} ref={this.map}></div>\n        {/* {JSON.stringify(data)} */}\n      </>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  mapObj: state.mapObj,\n  _lat: state.lat,\n  _lng: state.lng,\n  zoomLevel: state.zoomLevel,\n  data: state.data\n})\n\nconst maDispatchToPrope = (dispatch) => ({\n  getDataAsync: bindActionCreators(getDataAsync, dispatch)\n})\n\nexport default connect(mapStateToProps, maDispatchToPrope)(Map)\n"]},"metadata":{},"sourceType":"module"}